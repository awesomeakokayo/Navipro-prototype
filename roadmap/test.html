<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Roadmap</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .top {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .headline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 2.2rem;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .subheading {
            color: #7f8c8d;
            font-size: 1rem;
        }

        .timeline {
            text-align: right;
        }

        .timeline-p {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .period {
            font-size: 1.4rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .progress {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-info h1 {
            font-size: 1.5rem;
            color: #2c3e50;
        }

        .progress-info p {
            color: #7f8c8d;
        }

        .progress-percentage {
            text-align: right;
        }

        .progress-percentage p:first-child {
            font-size: 2rem;
            font-weight: 700;
            color: #3498db;
        }

        .progress-percentage p:last-child {
            color: #7f8c8d;
        }

        .progress-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .filling {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 33%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .bottom {
            position: relative;
            margin-bottom: 40px;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background: #3498db;
            z-index: 1;
        }

        .monthly-roadmap {
            position: relative;
            z-index: 2;
        }

        .month {
            display: flex;
            align-items: center;
            margin: 40px 0;
            position: relative;
        }

        .spot {
            width: 60px;
            height: 60px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 3;
            flex-shrink: 0;
        }

        .month-info {
            margin-left: 20px;
        }

        .month-info h1 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .month-info p {
            color: #7f8c8d;
        }

        .week-right, .week-left {
            display: flex;
            margin: 30px 0;
            position: relative;
        }

        .week-content, .week-content2 {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            width: 45%;
        }

        .week-content h3, .week-content2 h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .week-number {
            color: #3498db;
            font-weight: bold;
        }

        .week-focus {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-style: italic;
        }

        .week-content ul, .week-content2 ul {
            list-style-type: none;
        }

        .week-content li, .week-content2 li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .week-content li:hover, .week-content2 li:hover {
            background: #e8f4fc;
            transform: translateX(5px);
        }

        .week-content li.completed, .week-content2 li.completed {
            border-left-color: #2ecc71;
            background: #eafaf1;
            text-decoration: line-through;
            color: #7f8c8d;
        }

        .number, .number2 {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 10%;
        }

        .week-icon, .week-icon2 {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45%;
        }

        .week-right .week-content {
            margin-right: auto;
        }

        .week-right .week-icon {
            margin-left: auto;
        }

        .week-right .week-content2 {
            margin-left: auto;
        }

        .week-right .week-icon2 {
            margin-right: auto;
        }

        .footer {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .footer h3 {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .footer p {
            color: #7f8c8d;
            line-height: 1.8;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            animation: slideIn 0.3s ease, fadeOut 0.5s ease 2.5s forwards;
        }

        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }

        @media (max-width: 768px) {
            .headline {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .timeline {
                text-align: center;
            }
            
            .progress-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .progress-percentage {
                text-align: center;
            }
            
            .week-right, .week-left {
                flex-direction: column;
                align-items: center;
            }
            
            .week-content, .week-content2 {
                width: 100%;
                margin: 15px 0;
            }
            
            .week-icon, .week-icon2 {
                order: -1;
                margin: 15px 0;
            }
            
            .number, .number2 {
                display: none;
            }
            
            .timeline-line {
                left: 30px;
            }
            
            .month {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .month-info {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top">
            <div class="headline">
                <span>
                    <h1 class="title">Your Career Roadmap</h1>
                    <p class="subheading">Personalized path to success</p>
                </span>

                <span class="timeline">
                    <p class="timeline-p"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='%237f8c8d' d='M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2z'/%3E%3C/svg%3E" alt="Calendar icon"> Target Timeline</p>
                    <h3 class="period">6 months</h3>
                </span>
            </div>

            <div class="progress">
                <div class="progress-info">
                    <span>
                        <h1>Goal: Full Stack Developer</h1>
                        <p>Month 1 of 6 • Keep going</p>
                    </span>

                    <span class="progress-percentage">
                        <p>25%</p>
                        <p>complete</p>
                    </span>
                </div>

                <div class="progress-bar">
                    <div id="filling" class="filling"></div>
                </div>
            </div>
        </div>

        <div class="bottom">
            <div class="timeline-line"></div>
            <div class="monthly-roadmap">
                <!-- Content will be generated by JavaScript -->
            </div>
        </div>
        
        <div class="footer">
            <h3><span><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='%232c3e50' d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z'/%3E%3C/svg%3E" alt="Trophy icon"></span> Roadmap Progress</h3>
            <br>
            <p>Working towards your goal:<br> <b>Become a Full Stack Developer</b></p>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            // Get user ID from backend (replace with your actual implementation)
            const userId = await getUserIdFromBackend();
            
            if (!userId) {
                window.location.href = "../index.html";
                return;
            }

            try {
                // Fetch roadmap data from backend
                const roadmapData = await fetchRoadmapData(userId);
                updateRoadmapDisplay(roadmapData);
                setupProgressTracking(userId, roadmapData);
            } catch (err) {
                console.error("Failed to load roadmap:", err);
                alert("Could not load roadmap. Please try again later.");
            }
        });

        // Function to get user ID from backend (replace with your implementation)
        async function getUserIdFromBackend() {
            // This should be replaced with your actual backend integration
            // For example: 
            // const response = await fetch('/api/user/id');
            // const data = await response.json();
            // return data.userId;
            
            // For demonstration, we'll return a fixed user ID
            return "user-12345";
        }

        // Function to fetch roadmap data from backend
        async function fetchRoadmapData(userId) {
            try {
                // Replace with your actual API endpoint
                // const response = await fetch(`/api/roadmap/${userId}`);
                // if (!response.ok) throw new Error('Failed to fetch roadmap');
                // return await response.json();
                
                // Simulating API response for demonstration
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Get completed tasks from localStorage for this user
                const completedTasks = JSON.parse(localStorage.getItem(`completedTasks_${userId}`) || "[]");
                
                // Mock roadmap data
                return {
                    goal: "Become a Full Stack Developer",
                    target_role: "Full Stack Developer",
                    timeframe: "6_months",
                    progress: {
                        current_month: 1,
                        total_tasks_completed: completedTasks.length,
                        completed_task_ids: completedTasks
                    },
                    roadmap: [
                        {
                            month_title: "Foundation Building",
                            focus: "HTML, CSS, and JavaScript Basics",
                            weeks: [
                                {
                                    week_number: 1,
                                    focus: "HTML Fundamentals",
                                    daily_tasks: [
                                        { task_id: "task-1-1-1", title: "Learn HTML structure and semantics" },
                                        { task_id: "task-1-1-2", title: "Practice creating basic pages" },
                                        { task_id: "task-1-1-3", title: "Build a simple portfolio page" }
                                    ]
                                },
                                {
                                    week_number: 2,
                                    focus: "CSS Styling",
                                    daily_tasks: [
                                        { task_id: "task-1-2-1", title: "Learn CSS selectors and properties" },
                                        { task_id: "task-1-2-2", title: "Practice responsive design" },
                                        { task_id: "task-1-2-3", title: "Style your portfolio page" }
                                    ]
                                },
                                {
                                    week_number: 3,
                                    focus: "JavaScript Basics",
                                    daily_tasks: [
                                        { task_id: "task-1-3-1", title: "Learn JavaScript syntax" },
                                        { task_id: "task-1-3-2", title: "Practice DOM manipulation" },
                                        { task_id: "task-1-3-3", title: "Add interactivity to your portfolio" }
                                    ]
                                },
                                {
                                    week_number: 4,
                                    focus: "Project Week",
                                    daily_tasks: [
                                        { task_id: "task-1-4-1", title: "Plan a personal website" },
                                        { task_id: "task-1-4-2", title: "Implement the website design" },
                                        { task_id: "task-1-4-3", title: "Add JavaScript functionality" },
                                        { task_id: "task-1-4-4", title: "Test and deploy your website" }
                                    ]
                                }
                            ]
                        },
                        {
                            month_title: "Frontend Development",
                            focus: "React and Modern JavaScript",
                            weeks: [
                                {
                                    week_number: 5,
                                    focus: "Advanced JavaScript",
                                    daily_tasks: [
                                        { task_id: "task-2-1-1", title: "Learn ES6+ features" },
                                        { task_id: "task-2-1-2", title: "Practice async programming" },
                                        { task_id: "task-2-1-3", title: "Study modules and bundlers" }
                                    ]
                                },
                                {
                                    week_number: 6,
                                    focus: "React Fundamentals",
                                    daily_tasks: [
                                        { task_id: "task-2-2-1", title: "Learn React components and JSX" },
                                        { task_id: "task-2-2-2", title: "Practice state management" },
                                        { task_id: "task-2-2-3", title: "Build a simple React app" }
                                    ]
                                }
                            ]
                        }
                    ]
                };
            } catch (error) {
                console.error("Error fetching roadmap data:", error);
                throw error;
            }
        }

        function updateRoadmapDisplay(roadmapData) {
            updateHeaderInfo(roadmapData);
            updateProgressSection(roadmapData);
            generateRoadmapContent(roadmapData);
            updateFooter(roadmapData);
            updateProgressBar(roadmapData);
        }

        function updateHeaderInfo(roadmapData) {
            const title = document.querySelector(".title");
            if (title) {
                title.textContent = `Your ${roadmapData.target_role || "Career"} Roadmap`;
            }

            const timeline = document.querySelector(".period");
            if (timeline) {
                const timeframeMap = {
                    "3_months": "3 Months",
                    "6_months": "6 Months",
                    "1_year": "1 Year",
                    not_sure: "3 Months",
                };
                timeline.textContent = timeframeMap[roadmapData.timeframe] || "6 Months";
            }
        }

        function updateProgressSection(roadmapData) {
            const goalElement = document.querySelector(".progress-info h1");
            if (goalElement) {
                goalElement.textContent = `Goal: ${roadmapData.goal || "Career Development"}`;
            }

            const progressInfo = document.querySelector(".progress-info p");
            if (progressInfo) {
                const progress = roadmapData.progress || {};
                const currentMonth = progress.current_month || 1;
                const totalMonths = roadmapData.roadmap ? roadmapData.roadmap.length : 0;
                progressInfo.textContent = `Month ${currentMonth} of ${totalMonths} • Keep going`;
            }

            const progressPercentage = document.querySelector(".progress-percentage p");
            if (progressPercentage) {
                const progress = roadmapData.progress || {};
                const totalTasks = calculateTotalTasks(roadmapData);
                const completedTasks = progress.total_tasks_completed || 0;
                const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                progressPercentage.textContent = `${percentage}%`;
            }
        }

        function updateProgressBar(roadmapData) {
            const progress = roadmapData.progress || {};
            const totalTasks = calculateTotalTasks(roadmapData);
            const completedTasks = progress.total_tasks_completed || 0;
            const percentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;

            const progressBar = document.getElementById("filling");
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
            }
        }

        function generateRoadmapContent(roadmapData) {
            const roadmapContainer = document.querySelector(".monthly-roadmap");
            if (!roadmapContainer) return;

            roadmapContainer.innerHTML = "";

            if (roadmapData.roadmap && roadmapData.roadmap.length > 0) {
                // Get completed task IDs from progress data
                const completedTaskIds = roadmapData.progress?.completed_task_ids || [];
                
                roadmapData.roadmap.forEach((month, monthIndex) => {
                    const monthElement = createMonthElement(month, monthIndex + 1);
                    roadmapContainer.appendChild(monthElement);

                    if (month.weeks && month.weeks.length > 0) {
                        month.weeks.forEach((week, weekIndex) => {
                            const weekElement = createWeekElement(week, monthIndex + 1, weekIndex + 1, completedTaskIds);
                            roadmapContainer.appendChild(weekElement);
                        });
                    }
                });
            } else {
                roadmapContainer.innerHTML = "<p>No roadmap data available. Please try again later.</p>";
            }
        }

        function createMonthElement(month, monthNumber) {
            const monthDiv = document.createElement("div");
            monthDiv.className = "month";

            monthDiv.innerHTML = `
                <div class="spot">${monthNumber}</div>
                <span class="month-info"> 
                    <h1>Month ${monthNumber}</h1>
                    <p>${month.month_title || month.focus || "Skills Building"}</p>
                </span>
            `;

            return monthDiv;
        }

        function createWeekElement(week, monthNumber, weekNumber, completedTaskIds = []) {
            const weekDiv = document.createElement("div");
            weekDiv.className = "week-right";

            weekDiv.innerHTML = `
                <div class="week-content">
                    <h3><span class="week-number">${week.week_number || weekNumber}</span> Week ${week.week_number || weekNumber}</h3>
                    <p class="week-focus">${week.focus || "Weekly Focus"}</p>
                    <ul>
                        ${(week.daily_tasks || [])
                            .map(
                                (task) => {
                                    const isCompleted = completedTaskIds.includes(task.task_id);
                                    return `<li data-task-id="${task.task_id || ""}" class="${isCompleted ? 'completed' : ''}">${task.title || "Task"}</li>`;
                                }
                            )
                            .join("")}
                    </ul>
                </div>
                <div class="number">
                    <span class="number">
                        <img width="45" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%233498db'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white'%3E${weekNumber}%3C/text%3E%3C/svg%3E" alt="Week ${weekNumber}">
                    </span>
                </div>
                <div class="week-icon">
                    <img width="300" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300'%3E%3Ccircle cx='150' cy='150' r='140' fill='%23e0e0e0'/%3E%3Ctext x='150' y='165' font-size='60' text-anchor='middle' fill='%23333'%3EWeek ${weekNumber}%3C/text%3E%3C/svg%3E" alt="Week ${weekNumber} illustration">
                </div>
            `;

            return weekDiv;
        }

        function updateFooter(roadmapData) {
            const footerText = document.querySelector(".footer p");
            if (footerText) {
                footerText.innerHTML = `Working towards your goal:<br> <b>${roadmapData.goal || "Career Development"}</b>`;
            }
        }

        function calculateTotalTasks(roadmapData) {
            let total = 0;
            if (roadmapData.roadmap) {
                roadmapData.roadmap.forEach((month) => {
                    if (month.weeks) {
                        month.weeks.forEach((week) => {
                            total += (week.daily_tasks || []).length;
                        });
                    }
                });
            }
            return total;
        }

        function setupProgressTracking(userId, roadmapData) {
            const taskItems = document.querySelectorAll(".week-content li");

            taskItems.forEach((taskItem) => {
                taskItem.addEventListener("click", async function () {
                    const taskId = this.getAttribute("data-task-id");
                    if (!taskId) {
                        console.error("No task ID found for this task");
                        return;
                    }

                    // Check if already completed to prevent double counting
                    const alreadyCompleted = this.classList.contains("completed");
                    
                    try {
                        // In a real scenario, this would call your backend
                        const result = await completeTask(userId, taskId, !alreadyCompleted);
                        
                        if (result.status === "success") {
                            // Update UI based on completion status
                            if (!alreadyCompleted) {
                                this.classList.add("completed");
                                showCompletionMessage("Task completed! Great job!");
                            } else {
                                this.classList.remove("completed");
                            }
                            
                            // Update progress display
                            updateProgressDisplay(result, roadmapData);
                        }
                    } catch (error) {
                        console.error("Error completing task:", error);
                    }
                });
            });
        }

        // Function to mark task as complete (replace with your backend integration)
        async function completeTask(userId, taskId, complete) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // Get current completed tasks from localStorage
            let completedTasks = JSON.parse(localStorage.getItem(`completedTasks_${userId}`) || "[]");
            
            if (complete) {
                // Add task to completed list if not already there
                if (!completedTasks.includes(taskId)) {
                    completedTasks.push(taskId);
                }
            } else {
                // Remove task from completed list
                completedTasks = completedTasks.filter(id => id !== taskId);
            }
            
            // Save updated completed tasks to localStorage
            localStorage.setItem(`completedTasks_${userId}`, JSON.stringify(completedTasks));
            
            // For demo, return mock response
            return {
                status: "success",
                message: complete ? "Task marked as completed" : "Task marked as incomplete",
                total_completed: completedTasks.length,
                progress: {
                    current_month: 1,
                    total_tasks_completed: completedTasks.length
                }
            };
        }

        function updateProgressDisplay(result, roadmapData) {
            // Update progress percentage
            const progressPercentage = document.querySelector(".progress-percentage p");
            if (progressPercentage) {
                const totalTasks = calculateTotalTasks(roadmapData);
                const completedTasks = result.progress.total_tasks_completed || 0;
                const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                progressPercentage.textContent = `${percentage}%`;
            }

            // Update progress bar
            const progressBar = document.getElementById("filling");
            if (progressBar) {
                const totalTasks = calculateTotalTasks(roadmapData);
                const completedTasks = result.progress.total_tasks_completed || 0;
                const percentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
                progressBar.style.width = `${percentage}%`;
            }

            // Update progress info text
            const progressInfo = document.querySelector(".progress-info p");
            if (progressInfo) {
                const progress = roadmapData.progress || {};
                const currentMonth = progress.current_month || 1;
                const totalMonths = roadmapData.roadmap ? roadmapData.roadmap.length : 0;
                progressInfo.textContent = `Month ${currentMonth} of ${totalMonths} • Keep going`;
            }
        }

        function showCompletionMessage(message) {
            const notification = document.createElement("div");
            notification.className = "notification";
            notification.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                ${message}
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>